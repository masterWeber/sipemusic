---
const mailRuId = import.meta.env.PUBLIC_MAIL_RU_ID
---

<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8"/>
    <meta name="viewport" content="width=device-width"/>
    <link rel="icon" type="image/svg+xml" href="/favicon.svg"/>
    <link rel="icon" href="/favicon.ico"/>
    <title>SIPE MUSIC</title>
    <meta name="description"
          content="Проект Sipe это не просто музыка, это целая вселенная, где каждый трек живёт своей жизнью. Это пространство для экспериментов, поиска и вдохновения, где не бывает конечной точки. Музыка здесь это путь, который никогда не заканчивается."/>
</head>
<body>
<slot/>
</body>
</html>

<script>
  const scene = document.getElementById('scene') as HTMLElement | null
  if (scene) {
    const layers = Array.from(scene.querySelectorAll<HTMLElement>('[data-depth]'))
    const clamp = (value: number, min: number, max: number) => Math.min(max, Math.max(min, value))

    let targetX = 0
    let targetY = 0
    let currentX = 0
    let currentY = 0
    let rafId = 0

    const updateTarget = (x: number, y: number) => {
      targetX = clamp(x, -1, 1)
      targetY = clamp(y, -1, 1)
      if (!rafId) {
        rafId = window.requestAnimationFrame(tick)
      }
    }

    const tick = () => {
      currentX += (targetX - currentX) * 0.08
      currentY += (targetY - currentY) * 0.08

      for (const layer of layers) {
        const depth = Number(layer.dataset.depth ?? 0)
        const moveX = currentX * depth * 30
        const moveY = currentY * depth * 30
        layer.style.transform = `translate3d(${moveX}px, ${moveY}px, 0)`
      }

      if (Math.abs(targetX - currentX) > 0.001 || Math.abs(targetY - currentY) > 0.001) {
        rafId = window.requestAnimationFrame(tick)
      } else {
        rafId = 0
      }
    }

    const onPointerMove = (event: PointerEvent) => {
      const rect = scene.getBoundingClientRect()
      const x = (event.clientX - rect.left) / rect.width
      const y = (event.clientY - rect.top) / rect.height
      updateTarget((x - 0.5) * 2, (y - 0.5) * 2)
    }

    const onDeviceOrientation = (event: DeviceOrientationEvent) => {
      if (event.beta === null || event.gamma === null) return
      const x = clamp(event.gamma / 30, -1, 1)
      const y = clamp(event.beta / 30, -1, 1)
      updateTarget(x, y)
    }

    document.addEventListener('pointermove', onPointerMove)
    window.addEventListener('deviceorientation', onDeviceOrientation)
  }
</script>

<!-- Top.Mail.Ru counter -->
<script type="text/javascript" define:vars={{mailRuId}}>
  var _tmr = window._tmr || (window._tmr = [])
  _tmr.push({id: mailRuId, type: 'pageView', start: (new Date()).getTime()});
  (function (d, w, id) {
    if (d.getElementById(id)) return
    var ts = d.createElement('script')
    ts.type = 'text/javascript'
    ts.async = true
    ts.id = id
    ts.src = 'https://top-fwz1.mail.ru/js/code.js'
    var f = function () {
      var s = d.getElementsByTagName('script')[0]
      s.parentNode.insertBefore(ts, s)
    }
    if (w.opera == '[object Opera]') {
      d.addEventListener('DOMContentLoaded', f, false)
    } else {
      f()
    }
  })(document, window, 'tmr-code')
</script>
<noscript>
    <div><img src={`https://top-fwz1.mail.ru/counter?id=${mailRuId};js=na`} style="position:absolute;left:-9999px;"
              alt="Top.Mail.Ru"/></div>
</noscript>
<!-- /Top.Mail.Ru counter -->

<style lang="scss">
  @font-face {
    font-family: 'LDRCondensed2.0';
    src: url('../assets/LDRCondensed2.0-Regular-CYRILLIC.ttf') format('truetype');
    font-weight: 400;
    font-style: normal;
    font-display: swap;
  }

  * {
    box-sizing: border-box;
  }

  html,
  body {
    margin: 0;
    width: 100%;
    min-height: 100%;
    font-family: 'LDRCondensed2.0', 'Helvetica Neue', Arial, sans-serif;
    background: #2C2C2C;
    font-size: 8px;
    scroll-behavior: smooth;

    @media (max-width: 860px) {
      background: #DFDFDF;
    }
  }

  body {
    padding: 16px 16px 100px;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: auto;

    @media (max-width: 860px) {
      padding: 0;
    }
  }
</style>
